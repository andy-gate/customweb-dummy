<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XML Download - CustomWeb SPAN</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/sidebar.js"></script>
    <script src="js/components.js"></script>
</head>
<body>
    <!-- Header Placeholder -->
    <div id="header-placeholder"></div>

    <!-- Sidebar Placeholder -->
    <div id="sidebar-placeholder"></div>

    <!-- Main Content Wrapper -->
    <div class="main-wrapper" id="mainWrapper">
        <div class="container">
            <h2 style="margin-bottom: 1.5rem;">XML Download</h2>

            <!-- Data Table Section -->
            <div class="card">
                <div style="display: flex; justify-content: flex-end; gap: 0.5rem; margin-bottom: 1rem; padding: 0 1rem; padding-top: 1rem;">
                    <button class="btn btn-primary" onclick="downloadSelected()" style="background-color: #6f42c1; border-color: #6f42c1;">
                        Download
                    </button>
                </div>

                <!-- Data Table -->
                <div class="table-container">
                    <table class="table" style="table-layout: fixed;">
                        <thead>
                            <tr>
                                <th style="width: 80px; text-align: center;">No</th>
                                <th style="width: 60px; text-align: center;">
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th style="min-width: 300px; text-align: left;">Table</th>
                            </tr>
                        </thead>
                        <tbody id="dataTable">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Placeholder -->
    <div id="footer-placeholder"></div>

    <script>
        // Initialize page components
        initPageComponents({
            activePage: 'manage-reference-data',
            userData: {
                avatar: 'DJA',
                role: 'Echelon IV DJA',
                tahun: '2025',
                jenisDok: 'RKAKL'
            }
        });

        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                sessionStorage.clear();
                window.location.href = 'index.html';
            }
        }

        // Data tabel
        const tableData = [
            { id: 1, name: 'T_AKUN', selected: true },
            { id: 2, name: 'T_BEBAN', selected: true },
            { id: 3, name: 'T_BKPK', selected: true },
            { id: 4, name: 'T_BLOKIR', selected: false },
            { id: 5, name: 'T_CTARIK', selected: false },
            { id: 6, name: 'T_DEKON', selected: false },
            { id: 7, name: 'T_DEPT', selected: false },
            { id: 8, name: 'T_ES2', selected: false },
            { id: 9, name: 'T_FUNGSI', selected: false },
            { id: 10, name: 'T_GBKPK', selected: false }
        ];

        function loadTableData() {
            const tableBody = document.getElementById('dataTable');
            const selectAllCheckbox = document.getElementById('selectAll');

            if (tableBody) {
                tableBody.innerHTML = '';
                
                tableData.forEach((item, index) => {
                    const tr = document.createElement('tr');
                    tr.setAttribute('data-id', item.id);
                    
                    // Highlight row jika selected
                    if (item.selected) {
                        tr.style.backgroundColor = '#f0f8ff';
                    }
                    
                    tr.innerHTML = `
                        <td style="text-align: center;">${index + 1}</td>
                        <td style="text-align: center;">
                            <input type="checkbox" class="table-checkbox" data-id="${item.id}" ${item.selected ? 'checked' : ''} onchange="updateSelection(${item.id})">
                        </td>
                        <td>${item.name}</td>
                    `;
                    tableBody.appendChild(tr);
                });
                
                // Update select all checkbox
                if (selectAllCheckbox) {
                    const allSelected = tableData.every(item => item.selected);
                    selectAllCheckbox.checked = allSelected;
                }
            }
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const isChecked = selectAllCheckbox.checked;
            
            tableData.forEach(item => {
                item.selected = isChecked;
            });
            
            // Update checkboxes
            const checkboxes = document.querySelectorAll('.table-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            // Update row highlighting
            const rows = document.querySelectorAll('#dataTable tr');
            rows.forEach((row, index) => {
                if (isChecked) {
                    row.style.backgroundColor = '#f0f8ff';
                } else {
                    row.style.backgroundColor = '';
                }
            });
        }

        function updateSelection(id) {
            const item = tableData.find(t => t.id === id);
            if (item) {
                item.selected = !item.selected;
                
                // Update row highlighting
                const row = document.querySelector(`#dataTable tr[data-id="${id}"]`);
                if (row) {
                    if (item.selected) {
                        row.style.backgroundColor = '#f0f8ff';
                    } else {
                        row.style.backgroundColor = '';
                    }
                }
                
                // Update select all checkbox
                const selectAllCheckbox = document.getElementById('selectAll');
                if (selectAllCheckbox) {
                    const allSelected = tableData.every(item => item.selected);
                    selectAllCheckbox.checked = allSelected;
                }
            }
        }

        function downloadSelected() {
            const selectedTables = tableData.filter(item => item.selected);
            
            if (selectedTables.length === 0) {
                alert('Mohon pilih minimal satu tabel untuk didownload!');
                return;
            }
            
            const tableNames = selectedTables.map(item => item.name).join(', ');
            if (confirm(`Apakah Anda yakin ingin mengunduh ${selectedTables.length} tabel berikut?\n\n${tableNames}`)) {
                alert(`Mengunduh ${selectedTables.length} tabel dalam format XML...\n\n${tableNames}`);
            }
        }

        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadTableData();
        });
    </script>

    <style>
        /* Table Container */
        .table-container {
            overflow-x: auto;
            position: relative;
        }

        /* Force table layout fixed to respect column widths */
        .table-container .table {
            table-layout: fixed !important;
            width: 100%;
        }

        /* Table Header Styles */
        .table thead tr th {
            background-color: #f8f9fa;
            font-weight: 600;
            border: 1px solid #dee2e6;
            border-bottom: 2px solid #dee2e6;
            padding: 0.75rem;
        }

        .table th {
            text-align: left;
        }

        .table td {
            text-align: left;
            padding: 0.75rem;
            border: 1px solid #dee2e6;
        }

        .table tbody tr:nth-child(even) {
            background-color: #f0f4f8;
        }

        .table tbody tr:nth-child(odd) {
            background-color: white;
        }

        .table tbody tr:hover {
            background-color: var(--light-color);
        }

        /* Checkbox Styles */
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .table-checkbox {
            margin: 0;
        }
    </style>
</body>
</html>
